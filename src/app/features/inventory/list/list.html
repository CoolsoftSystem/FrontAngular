<p-toolbar>
    <ng-template #start>
        <p-button icon="pi pi-print" class="mr-2" text severity="secondary" />
        <p-button icon="pi pi-upload" text severity="secondary" />
    </ng-template>
    <ng-template #center>
        <p-iconfield iconPosition="left">
            <p-inputicon class="pi pi-search" />
            <input type="search" pInputText [formControl]="searchInputControl"  placeholder="Buscar productos..." class="search-input"/>
        </p-iconfield>
    </ng-template>
    <ng-template #end>
        <p-button icon="pi pi-plus" label="Agregar Producto" class="mr-2" text severity="secondary" (click)="addNewProduct($event)" />
        <p-splitbutton pTooltip="Actualizar Datos" showDelay="1000" hideDelay="300" label="Save" [model]="items" />
    </ng-template>
</p-toolbar>
<div class="p-4">
  <div class="card">
    
    @if (filteredProducts.length > 0) {
      <p-table 
        #dt
        stripedRows 
        (sortFunction)="customSort($event)"
        [value]="products"
        [paginator]="true"
        [rows]="10"
        [rowsPerPageOptions]="[10, 15, 20]" 
        [size]="'small'" 
        [tableStyle]="{ 'min-width': '60rem' }"
        dataKey="id"
      >
        <ng-template #caption>
          <div class="flex items-center justify-between">
            <span class="text-xl font-bold">Productos</span>
            <p-button icon="pi pi-refresh" rounded raised />
          </div>
        </ng-template>
        <ng-template #header>
          <tr>
            <th pSortableColumn="name">
              <div class="flex items-center gap-2">
                Nombre
                <p-sortIcon field="name" />
              </div>
            </th>
            <th pSortableColumn="code">
              <div class="flex items-center gap-2">
                Código
                <p-sortIcon field="code" />
              </div>
            </th>
            <th pSortableColumn="location">
              <div class="flex items-center gap-2">
                Ubicación
                <p-sortIcon field="location" />
              </div>
            </th>
            <th pSortableColumn="price">
              <div class="flex items-center gap-2">
                Precio
                <p-sortIcon field="price" />
              </div>
            </th>
            <th pSortableColumn="category" >
              <div class="flex items-center gap-2">
                Categoría
                <p-sortIcon field="category" />
              </div>
            </th>
            <th pSortableColumn="brand">
              <div class="flex items-center gap-2">
                Marca
                <p-sortIcon field="brand" />
              </div>
            </th>
            <th pSortableColumn="quantity">
              <div class="flex items-center gap-2">
                Cantidad
                <p-sortIcon field="quantity" />
              </div>
            </th>
            <th pSortableColumn="status">
              <div class="flex items-center gap-2">
                Estado
                <p-sortIcon field="status" />
              </div>
            </th>
            <th>Acciones</th>
          </tr>
        </ng-template>
        <ng-template #body let-product>
          <tr>
            <td>{{ product.name }}</td>
            <td>{{ product.code }}</td>
            <td>{{ product.location }}</td>
            <td>{{ product.price | currency: 'USD' }}</td>
            <td>{{ product.category }}</td>
            <td>{{ product.brand }}</td>
            <td>{{ product.quantity }}</td>
            <td>
              <p-tag [value]="getStatus(product.status)" [severity]="getSeverity(product.status)" />
            </td>
            <td>
              <p-button icon="pi pi-pencil" pTooltip="Editar" showDelay="1000" hideDelay="300" severity="secondary" (click)="editProduct(product, $event)" class="mr-5"/>
              <p-button icon="pi pi-trash" pTooltip="Eliminar" showDelay="1000" hideDelay="300" severity="danger"  (click)="confirmDelete($event, product)" [outlined]="true"  />
            </td>
          </tr>
        </ng-template>
        <ng-template #footer>
            <tr>
                <td colspan="9">En total hay {{ products ? products.length : 0 }} productos.</td>
            </tr>
        </ng-template>
      </p-table>
    } @else {
      <div class="p-8 sm:p-16 border-t text-gray-400 text-4xl font-semibold tracking-tight text-center">
        No hay productos
      </div>
    }
  </div>

</div>
<app-details></app-details>

<!-- Dialogo para eliminar Producto -->
<div class="card flex justify-center gap-2">
    <p-toast position="bottom-right" key="br"/>
    <p-confirmdialog />
</div>


<!-- <p-dialog [header]="`Eliminar Prodocuto ${deleteProduct?.name ?? ''}`" [modal]="true" [(visible)]="showDialogDelete" [style]="{ width: '35rem' }"  maskStyleClass="backdrop-blur-sm" >
  <span class="p-text-secondary block mb-8">¿Está seguro que desea eliminar este producto?</span>
  <div class="flex flex-row w-full items-center gap-4 mb-4">
    <label for="username" class="font-semibold  mr-1">Estado: </label>
    <p-tag [value]="getStatus(deleteProduct?.status ?? 0)" [severity]="getSeverity(deleteProduct?.status ?? 0)" />
  </div>
  <div class="flex justify-end gap-2 mt-5">
    <p-button label="Cancel" severity="secondary" (click)="showDialogDelete = false" />
    <p-button label="Desvincular" severity="contrast" (click)="showDialogDelete = false" />
    <p-button label="Eliminar" severity="danger" (click)="deletingProduct()" />
  </div>
</p-dialog> -->
